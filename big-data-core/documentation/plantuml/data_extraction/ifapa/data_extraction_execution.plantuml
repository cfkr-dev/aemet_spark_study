@startuml
actor User

participant "IfapaAPIClient" as IFAPA_CLIENT
participant "SingleStationInfo" as SINGLE_STATION_INFO
participant "SingleStationMeteo" as SINGLE_STATION_METEO
participant "HTTPUtils" as HTTP_UTILS
participant "FileUtils" as FILE_UTILS

User -> IFAPA_CLIENT : ifapaDataExtraction()
activate IFAPA_CLIENT

'--- STATION METADATA ---
IFAPA_CLIENT -> SINGLE_STATION_INFO : saveSingleStationInfoMetadata()
activate SINGLE_STATION_INFO
SINGLE_STATION_INFO -> SINGLE_STATION_INFO : doWhileWithGetAndSave()
alt retry until success
    SINGLE_STATION_INFO -> HTTP_UTILS : getIfapaAPIResource()
    alt success
        HTTP_UTILS --> SINGLE_STATION_INFO : JSON response
        SINGLE_STATION_INFO -> FILE_UTILS : saveContentToPath(metadata)
        FILE_UTILS --> SINGLE_STATION_INFO : success
    else failure
        HTTP_UTILS --> SINGLE_STATION_INFO : exception
        SINGLE_STATION_INFO -> SINGLE_STATION_INFO : retry doWhileWithGetAndSave()
    end
end
SINGLE_STATION_INFO --> IFAPA_CLIENT : done
deactivate SINGLE_STATION_INFO

'--- METEO METADATA ---
IFAPA_CLIENT -> SINGLE_STATION_METEO : saveSingleStationMeteoInfoMetadata()
activate SINGLE_STATION_METEO
SINGLE_STATION_METEO -> SINGLE_STATION_METEO : doWhileWithGetAndSave()
alt retry until success
    SINGLE_STATION_METEO -> HTTP_UTILS : getIfapaAPIResource()
    alt success
        HTTP_UTILS --> SINGLE_STATION_METEO : JSON response
        SINGLE_STATION_METEO -> FILE_UTILS : saveContentToPath(metadata)
        FILE_UTILS --> SINGLE_STATION_METEO : success
    else failure
        HTTP_UTILS --> SINGLE_STATION_METEO : exception
        SINGLE_STATION_METEO -> SINGLE_STATION_METEO : retry doWhileWithGetAndSave()
    end
end
SINGLE_STATION_METEO --> IFAPA_CLIENT : done
deactivate SINGLE_STATION_METEO

'--- STATION DATA ---
IFAPA_CLIENT -> SINGLE_STATION_INFO : saveSingleStationInfo()
activate SINGLE_STATION_INFO
SINGLE_STATION_INFO -> SINGLE_STATION_INFO : doWhileWithGetAndSave()
alt retry until success
    SINGLE_STATION_INFO -> HTTP_UTILS : getIfapaAPIResource()
    alt success
        HTTP_UTILS --> SINGLE_STATION_INFO : JSON response
        SINGLE_STATION_INFO -> FILE_UTILS : saveContentToPath(data)
        FILE_UTILS --> SINGLE_STATION_INFO : success
    else failure
        HTTP_UTILS --> SINGLE_STATION_INFO : exception
        SINGLE_STATION_INFO -> SINGLE_STATION_INFO : retry doWhileWithGetAndSave()
    end
end
SINGLE_STATION_INFO --> IFAPA_CLIENT : done
deactivate SINGLE_STATION_INFO

'--- METEO DATA ---
IFAPA_CLIENT -> SINGLE_STATION_METEO : saveSingleStationMeteoInfo()
activate SINGLE_STATION_METEO
SINGLE_STATION_METEO -> SINGLE_STATION_METEO : saveSingleStationMeteoInfoAction() [loop over date ranges]
alt retry until success
    SINGLE_STATION_METEO -> HTTP_UTILS : getIfapaAPIResource()
    alt success
        HTTP_UTILS --> SINGLE_STATION_METEO : JSON response
        SINGLE_STATION_METEO -> FILE_UTILS : saveContentToPath(data)
        FILE_UTILS --> SINGLE_STATION_METEO : success
    else failure
        HTTP_UTILS --> SINGLE_STATION_METEO : exception
        SINGLE_STATION_METEO -> SINGLE_STATION_METEO : retry doWhileWithGetAndSave()
    end
end
SINGLE_STATION_METEO --> IFAPA_CLIENT : done
deactivate SINGLE_STATION_METEO

IFAPA_CLIENT --> User : finished
deactivate IFAPA_CLIENT
@enduml
