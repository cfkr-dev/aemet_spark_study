include "../../global/schema/spark.conf"
include "../url/global.conf"
include "../storage/single-param-studies.conf"
include "global.conf"

// -- TOP 10 --

top-10-values = {
  order = [
    "highest",
    "lowest"
  ],
  temporal = [
    {
      value = "2024",
      title = "Year 2024"
    },
    {
      value = "decade",
      title = "In the last decade"
    },
    {
      value = "global",
      title = "From the beggining of the records"
    },
  ]
}

top-10 = {
  uri = ${bar-chart},
  body = {
    src = {
      path = ${top-10.data-src},
      axis = {
        x = {
          name = ${special-columns.top}
        },
        y = {
          name = ${special-columns.col-grouped}
        }
      }
    },
    dest = {
      path = ${top-10.data-dest},
      filename = "plot",
      export-png = true
    },
    style = {
      lettering = {
        // Params:
        // 1 - Order (highest/lowest)
        // 2 - Meteo param
        title = "Top 10 stations with %s %s",

        // Params:
        // 1 - temporal title (year 2024/last decade/from the start of registries)
        subtitle = "%s",
        x-label = "Top",

        // Params:
        // 1 - Meteo param
        // 2 - Units
        y-label = "%s (%s)",
        inside-info = [
          {
            label = "Station",
            build = [
              {
                text-before = "",
                name = ${stations-df.station-id},
                text-after = " "
              },
              {
                text-before = "",
                name = ${stations-df.station-name},
                text-after = " "
              },
              {
                text-before = "(",
                name = ${stations-df.state},
                text-after = ")."
              }
            ]
          },
          {
            label = "Location",
            build = [
              {
                text-before = "",
                name = ${stations-df.lat-dms},
                text-after = " "
              },
              {
                text-before = "",
                name = ${stations-df.long-dms},
                text-after = " "
              },
              {
                text-before = "(",
                name = ${stations-df.altitude},
                text-after = " m)."
              }
            ]
          }
        ]
      },
      figure = {
        inverted-horizontal-axis = false,
        threshold-limit-max-min = 0.5,
        threshold-perc-limit-outside-text = 0.3,
        range-margin-perc = 0.05,
        color = "#4169e1"
      },
      margin = {
        left = 120,
        right = 120,
        top = 100,
        bottom = 100
      }
    }
  }
}

// -- TOP 5 INC --

top-5-inc-values = {
  order = [
    "highest",
    "lowest"
  ]
}

top-5-inc = {
  uri = ${bar-chart},
  body = {
    src = {
      path = ${top-5-inc.data-src},
      axis = {
        x = {
          name = ${special-columns.top}
        },
        y = {
          name = ${special-columns.inc}
        }
      }
    },
    dest = {
      path = ${top-5-inc.data-dest},
      filename = "plot",
      export-png = true
    },
    style = {
      lettering = {
        // Params:
        // 1 - Order (highest/lowest)
        // 2 - Meteo param
        title = "Top 5 stations with %s %s increment",
        subtitle = "From the start of registries",
        x-label = "Top",

        // Params:
        // 1 - Meteo param
        // 2 - Units
        y-label = "%s increment (%s)",
        inside-info = [
          {
            label = "Station",
            build = [
              {
                text-before = "",
                name = ${stations-df.station-id},
                text-after = " "
              },
              {
                text-before = "",
                name = ${stations-df.station-name},
                text-after = " "
              },
              {
                text-before = "(",
                name = ${stations-df.state},
                text-after = ")."
              }
            ]
          },
          {
            label = "Location",
            build = [
              {
                text-before = "",
                name = ${stations-df.lat-dms},
                text-after = " "
              },
              {
                text-before = "",
                name = ${stations-df.long-dms},
                text-after = " "
              },
              {
                text-before = "(",
                name = ${stations-df.altitude},
                text-after = " m)."
              }
            ]
          }
        ]
      },
      figure = {
        inverted-horizontal-axis = false,
        threshold-limit-max-min = 0.5,
        threshold-perc-limit-outside-text = 0.3,
        range-margin-perc = 0.05,
        color = "#4169e1"
      },
      margin = {
        left = 120,
        right = 120,
        top = 100,
        bottom = 100
      }
    }
  }
}

// -- EVOL 2024 --

evol-2024 = {
  uri = ${linear-chart},
  body = {
    src = {
      path = ${evol.evol-2024.data-src},
      axis = {
        x = {
          name = ${special-columns.date},
          format = ${formatters.timestamp}
        },
        y = {
          name = ${special-columns.col-daily-grouped}
        }
      }
    },
    dest = {
      path = ${evol.evol-2024.data-dest},
      filename = "plot",
      export-png = true
    },
    style = {
      lettering = {
        // Params:
        // 1 - Station name
        // 2 - Station ID
        // 3 - State
        // 4 - Meteo Param
        title = "%s - %s (%s) %s evolution (2024)",

        // Params:
        // 1 - Latitude coordinate
        // 2 - Longitude coordinate
        // 3 - Altitude
        subtitle = "Lat: %s. Long: %s. Alt: %s",
        x-label = "Date",

        // Params:
        // 1 - Meteo param
        // 2 - Units
        y-label = "%s (%s)"
      },
      figure = {
        // Params:
        // 1 - Meteo param
        name = "%s evolution"
        color = "#4169e1"
      },
      margin = {
        left = 80,
        right = 80,
        top = 80,
        bottom = 80
      },
      legend = {
        y-offset = -0.3
      }
    }
  }
}

// -- EVOL YEARLY GROUP --

evol-yearly-group = {
  uri = ${linear-regression-chart},
  body = {
    src = {
      main = {
        path = ${evol.evol-yearly-group.data-src},
        axis = {
          x = {
            name = ${special-columns.year},
            format = ${formatters.timestamp-year}
          },
          y = {
            name = ${special-columns.col-yearly-grouped}
          }
        }
      },
      regression = {
        path = ${evol.evol-yearly-group.regression-src},
        names = {
          slope = "beta_1",
          intercept = "beta_0"
        }
      }
    },
    dest = {
      path = ${evol.evol-yearly-group.data-dest},
      filename = "plot",
      export-png = true
    },
    style = {
      lettering = {
        // Params:
        // 1 - Station name
        // 2 - Station ID
        // 3 - State
        // 4 - Meteo Param
        title = "%s - %s (%s) %s evolution (from the start of registers)",

        // Params:
        // 1 - Latitude coordinate
        // 2 - Longitude coordinate
        // 3 - Altitude
        subtitle = "Lat: %s. Long: %s. Alt: %s",
        x-label = "Date",

        // Params:
        // 1 - Meteo param
        // 2 - Units
        y-1-label = "%s (%s)"

        // Params:
        // 1 - Meteo param
        // 2 - Units
        y-2-label = "%s (%s)"
      },
      figure-1 = {
        // Params:
        // 1 - Meteo param
        name = "%s evolution"
        color = "#4169e1"
      },
      figure-2 = {
        // Params:
        // 1 - Meteo param
        name = "%s regression"
        color = "#ff0000"
      },
      margin = {
        left = 120,
        right = 120,
        top = 100,
        bottom = 100
      },
      legend = {
        y-offset = -0.15
      }
    }
  }
}

// -- HEAT MAP 2024 --

heat-map-2024-values = [
  "continental",
  "canary_islands"
]

heat-map-2024 = {
  uri = ${heat-map-chart},
  body = {
    src = {
      path = ${heat-map-2024.data-src},
      names = {
        longitude = ${stations-df.long-dec},
        latitude = ${stations-df.lat-dec},
        value = ${special-columns.col-grouped}
      },

      // Params:
      // 1 - Location (continental/canary_islands)
      location = "%s",
    },
    dest = {
      path = ${heat-map-2024.data-dest},
      filename = "plot",
      export-png = true
    },
    style = {
      lettering = {
        // Params:
        // 1 - Meteo Param
        title = "%s heat map",

        // Params:
        // 1 - Location (continental/canary islands)
        subtitle = "Spain %s territory. 2024",
        long-label = "Longitude",
        lat-label = "Latitude",

        // Params:
        // 1 - Meteo param
        // 2 - Units
        legend-label = "%s (%s)"
        point-info = [
          {
            label = "Station",
            build = [
              {
                text-before = "",
                name = ${stations-df.station-id},
                text-after = " "
              },
              {
                text-before = "",
                name = ${stations-df.station-name},
                text-after = " "
              },
              {
                text-before = "(",
                name = ${stations-df.state},
                text-after = ")."
              }
            ]
          },
          {
            label = "Location",
            build = [
              {
                text-before = "",
                name = ${stations-df.lat-dms},
                text-after = " "
              },
              {
                text-before = "",
                name = ${stations-df.long-dms},
                text-after = " "
              },
              {
                text-before = "(",
                name = ${stations-df.altitude},
                text-after = " m)."
              }
            ]
          }
        ]
      },
      figure = {
        // Params:
        // 1 - Meteo param
        name = "%s heat map"
        color = "#000000",
        color-opacity = 0.5
        point-size = 3
      },
      margin = {
        left = 120,
        right = 120,
        top = 100,
        bottom = 100
      }
    }
  }
}